# 🎯 飞书多维表格股票投资管理系统

基于飞书开放平台API构建的完整股票投资管理系统，支持总仓位统计、市场分类分析、实时价格更新等高级功能。

## ✨ 系统特性

### 📊 核心功能
- **🏢 完整的多维表格系统**: 4个专业数据表，覆盖投资全流程
- **📈 实时统计分析**: 总仓位、总营收、收益率自动计算
- **🌍 市场分类管理**: 支持A股、美股、港股、基金分类统计
- **💹 价格追踪**: 实时价格更新和历史趋势分析
- **🎯 智能分析**: AI驱动的投资建议和风险提示
- **📱 飞书集成**: 完美集成飞书生态系统

### 🛠️ 技术架构
- **🔗 API集成**: 基于飞书开放平台RESTful API
- **🐍 Python开发**: 模块化设计，易于扩展
- **📊 数据可视化**: 自动生成投资分析报告
- **⚡ 实时同步**: 支持实时数据更新和分析

## 📋 系统架构

### 📑 数据表结构

#### 1. 持仓记录表
| 字段名 | 类型 | 说明 |
|--------|------|------|
| 股票代码 | 文本 | 股票唯一标识符 |
| 股票名称 | 文本 | 股票名称 |
| 市场类型 | 单选 | A股/美股/港股/基金 |
| 持仓数量 | 数字 | 持有股数 |
| 买入价格 | 货币 | 买入单价 |
| 当前价格 | 货币 | 当前市价 |
| 持仓市值 | 货币 | 市值=数量×现价 |
| 盈亏金额 | 货币 | 盈亏金额 |
| 盈亏比例 | 百分比 | 盈亏百分比 |
| 买入日期 | 日期 | 买入时间 |
| 备注 | 文本 | 补充说明 |

#### 2. 买卖记录表
| 字段名 | 类型 | 说明 |
|--------|------|------|
| 股票代码 | 文本 | 股票唯一标识符 |
| 股票名称 | 文本 | 股票名称 |
| 交易类型 | 单选 | 买入/卖出 |
| 交易价格 | 货币 | 交易单价 |
| 交易数量 | 数字 | 交易数量 |
| 交易金额 | 货币 | 交易总金额 |
| 交易日期 | 日期 | 交易时间 |
| 手续费 | 货币 | 交易费用 |
| 备注 | 文本 | 补充说明 |

#### 3. 价格历史表
| 字段名 | 类型 | 说明 |
|--------|------|------|
| 股票代码 | 文本 | 股票唯一标识符 |
| 股票名称 | 文本 | 股票名称 |
| 价格 | 货币 | 股票价格 |
| 时间戳 | 日期时间 | 记录时间 |
| 涨跌幅 | 百分比 | 价格变动 |
| 市场类型 | 单选 | A股/美股/港股/基金 |

#### 4. 分析结果表
| 字段名 | 类型 | 说明 |
|--------|------|------|
| 股票代码 | 文本 | 股票唯一标识符 |
| 股票名称 | 文本 | 股票名称 |
| 分析类型 | 单选 | 技术分析/基本面分析/消息面分析/综合分析 |
| 建议 | 单选 | 买入/持有/卖出/观望 |
| 置信度 | 百分比 | 建议置信度 |
| 分析日期 | 日期 | 分析时间 |
| 目标价格 | 货币 | 预期目标价 |
| 分析理由 | 文本 | 分析依据 |

## 🚀 快速开始

### 1️⃣ 环境准备

#### 安装依赖
```bash
pip install requests
```

#### 系统要求
- Python 3.6+
- 飞书企业账号
- 网络连接正常

### 2️⃣ 飞书应用配置

#### 创建应用
1. 访问 [飞书开放平台](https://open.feishu.cn/app/)
2. 创建"企业自建应用"
3. 填写应用信息：
   - 应用名称：股票投资管理系统
   - 应用描述：股票投资管理和分析系统

#### 开启权限
必须开启以下权限：
- ✅ 查看、评论、编辑和管理多维表格
- ✅ 查看、评论、编辑和管理云空间中所有文件
- ✅ 查看云空间中文件元数据
- ✅ 获取与发送单聊、群组消息
- ✅ 获取用户在群组中@机器人的消息

#### 启用机器人能力
1. 应用后台 → 应用能力 → 添加能力
2. 选择"机器人"
3. 创建版本并提交审核
4. 审核通过后启用

#### 文件夹授权
1. 创建群组（可以是一人群组）
2. 添加应用机器人为群成员
3. 创建文件夹并分享给群组
4. 授予"管理权限"

### 3️⃣ 系统部署

#### 运行配置指南
```bash
python3 feishu_config_guide.py
```

#### 创建股票投资系统
```bash
python3 feishu_bitable_manager.py
```

输入配置信息：
- App ID: `cli_xxxxxxxxxxxxxxxx`
- App Secret: `xxxxxxxxxxxxxxxx`

### 4️⃣ 数据导入

#### 自动导入示例数据
系统会自动导入以下示例数据：
- AAPL (Apple Inc.) - 美股
- 000001.SZ (平安银行) - A股
- 0700.HK (腾讯控股) - 港股

#### 手动导入数据
可以通过飞书界面直接添加、编辑数据，或使用API批量导入。

## 📊 统计分析功能

### 💼 持仓分析
- **总市值**: 所有持仓股票的总市值
- **总成本**: 所有持仓的总买入成本
- **总盈亏**: 当前盈亏金额
- **总收益率**: 整体投资收益率
- **市场分布**: 按A股/美股/港股/基金分类统计

### 💰 交易分析
- **交易频率**: 买入和卖出次数统计
- **交易金额**: 买入总额和卖出总额
- **净交易额**: 买卖差额
- **月度统计**: 按月份统计交易活动

### 📈 趋势分析
- **价格趋势**: 历史价格变动分析
- **波动率**: 股票价格波动程度
- **收益率**: 个股和整体收益率

### 💡 投资建议
基于数据分析自动生成：
- **配置建议**: 市场配置优化建议
- **风险提示**: 高风险股票警示
- **交易建议**: 基于交易频率的建议
- **机会识别**: 潜在投资机会

## 🔧 高级功能

### 📊 生成分析报告
```bash
python3 feishu_analytics.py
```

功能包括：
- 完整的投资组合分析
- 市场配置统计
- 交易活动分析
- 风险评估
- 投资建议

### 🔄 实时数据更新
系统支持：
- 实时价格获取
- 自动盈亏计算
- 统计数据更新
- 预警通知

### 📈 可视化报表
在飞书多维表格中可以：
- 创建图表和仪表板
- 设置数据透视表
- 生成趋势图
- 自定义分析视图

## 🛠️ 故障排除

### 常见问题

#### 1. "获取访问令牌失败"
**原因**: App ID或App Secret错误
**解决**: 
- 检查应用凭证是否正确
- 确认应用已发布
- 验证网络连接

#### 2. "创建多维表格失败"
**原因**: 权限不足
**解决**:
- 确认已开启多维表格权限
- 检查文件夹权限设置
- 验证机器人能力

#### 3. "没有云空间节点权限"
**原因**: 文件夹未授权给群组
**解决**:
- 确认机器人能力已启用
- 文件夹已分享给群组
- 群组权限为"管理"

#### 4. 数据同步失败
**原因**: API限制或网络问题
**解决**:
- 检查API调用频率
- 验证网络稳定性
- 重试数据同步

### 调试技巧

#### 启用详细日志
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

#### 检查API响应
```python
print("API响应:", response.json())
```

#### 验证配置信息
```python
print("App ID:", app_id)
print("App Secret:", app_secret[:8] + "...")
```

## 📞 技术支持

### 官方资源
- [飞书开放平台](https://open.feishu.cn/)
- [API文档](https://open.feishu.cn/document/)
- [开发者社区](https://open.feishu.cn/community/)

### 常用工具
- [飞书API调试台](https://open.feishu.cn/api-explorer/)
- [多维表格文档](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/bitable/notification)

### 最佳实践
1. **权限管理**: 按需开启权限，避免过度授权
2. **数据安全**: 定期备份重要数据
3. **性能优化**: 合理设置数据更新频率
4. **错误处理**: 完善的异常处理机制

## 📄 许可证

本项目基于 MIT 许可证开源。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进项目。

---

## 🎯 总结

飞书多维表格股票投资管理系统提供了：

- ✅ **完整的投资管理工具**: 从持仓到分析的完整流程
- ✅ **强大的统计分析**: 总仓位、市场分类、收益率分析
- ✅ **智能投资建议**: 基于数据的投资决策支持
- ✅ **飞书生态集成**: 无缝集成飞书办公协作
- ✅ **高度可定制**: 可根据需求扩展功能

通过这个系统，您可以在飞书中实现专业级的股票投资管理，获得深入的投资分析和决策支持。

---

**立即开始使用，体验专业级的股票投资管理！** 🚀